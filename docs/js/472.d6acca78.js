"use strict";(self["webpackChunkfe_useful_code"]=self["webpackChunkfe_useful_code"]||[]).push([[472],{5472:function(t,e,r){r.r(e),r.d(e,{default:function(){return p}});var a=function(){var t=this,e=t._self._c;return e("div",{staticClass:"note-page"},[e("el-card",[e("div",{staticClass:"row form-row"},[e("el-select",{staticStyle:{width:"120px"},attrs:{placeholder:"类别"},model:{value:t.form.type,callback:function(e){t.$set(t.form,"type",e)},expression:"form.type"}},t._l(t.typeListWithColor,(function(r){return e("el-option",{key:r.value,attrs:{label:r.label,value:r.value}},[e("span",{style:{color:r.color}},[t._v("●")]),e("span",{staticStyle:{"margin-left":"6px"}},[t._v(t._s(r.label))])])})),1),e("el-input",{staticStyle:{width:"140px"},attrs:{placeholder:"金额",clearable:""},model:{value:t.form.amount,callback:function(e){t.$set(t.form,"amount",e)},expression:"form.amount"}},[e("template",{slot:"append"},[t._v("¥")])],2),e("el-date-picker",{staticStyle:{width:"220px"},attrs:{type:"datetime","value-format":"timestamp",placeholder:"时间"},model:{value:t.form.time,callback:function(e){t.$set(t.form,"time",e)},expression:"form.time"}}),e("el-input",{staticStyle:{width:"280px"},attrs:{placeholder:"备注",clearable:""},model:{value:t.form.remark,callback:function(e){t.$set(t.form,"remark",e)},expression:"form.remark"}}),e("el-button",{attrs:{type:"primary"},on:{click:t.addRecord}},[t._v("添加")])],1),e("div",{staticClass:"row filter-row",staticStyle:{"margin-top":"12px"}},[e("el-select",{staticStyle:{width:"140px"},attrs:{placeholder:"全部类别",clearable:""},model:{value:t.filter.type,callback:function(e){t.$set(t.filter,"type",e)},expression:"filter.type"}},[e("el-option",{attrs:{label:"全部",value:null}}),t._l(t.typeList,(function(t){return e("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})}))],2),e("el-date-picker",{staticStyle:{width:"320px"},attrs:{type:"daterange","value-format":"timestamp","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},model:{value:t.filter.range,callback:function(e){t.$set(t.filter,"range",e)},expression:"filter.range"}}),e("el-input",{staticStyle:{width:"220px"},attrs:{placeholder:"关键字",clearable:""},model:{value:t.filter.keyword,callback:function(e){t.$set(t.filter,"keyword",e)},expression:"filter.keyword"}}),e("el-button",{on:{click:t.resetFilter}},[t._v("重置")]),e("el-button",{attrs:{type:"primary"},on:{click:t.exportCsv}},[t._v("导出 CSV")]),e("el-button",{attrs:{type:"success"},on:{click:t.saveToLocal}},[t._v("保存本地")]),e("el-button",{on:{click:t.loadFromLocal}},[t._v("从本地载入")])],1),e("div",{staticClass:"summary",staticStyle:{"margin-top":"12px"}},[e("span",[t._v("记录数："+t._s(t.filteredList.length))]),e("span",{staticStyle:{"margin-left":"20px"}},[t._v("总计：¥ "+t._s(t.formatMoney(t.totalAmount)))])]),e("el-table",{staticStyle:{width:"100%","margin-top":"12px"},attrs:{data:t.pagedList,stripe:""}},[e("el-table-column",{attrs:{prop:"type",label:"类别",width:"100"},scopedSlots:t._u([{key:"default",fn:function({row:r}){return[e("span",{style:{color:t.typeColorMap[r.type]}},[t._v("●")]),e("span",{staticStyle:{"margin-left":"6px"}},[t._v(t._s(r.type))])]}}])}),e("el-table-column",{attrs:{prop:"amount",label:"金额",width:"120"},scopedSlots:t._u([{key:"default",fn:function({row:e}){return[t._v("¥ "+t._s(t.formatMoney(e.amount)))]}}])}),e("el-table-column",{attrs:{prop:"remark",label:"备注"}}),e("el-table-column",{attrs:{prop:"time",label:"时间",width:"180"},scopedSlots:t._u([{key:"default",fn:function({row:e}){return[t._v(t._s(t.formatTimestamp(e.time)))]}}])}),e("el-table-column",{attrs:{label:"操作",width:"160"},scopedSlots:t._u([{key:"default",fn:function({row:r}){return[e("el-button",{attrs:{type:"text"},on:{click:function(e){return t.editRecord(r)}}},[t._v("编辑")]),e("el-button",{staticStyle:{color:"red"},attrs:{type:"text"},on:{click:function(e){return t.removeRecord(r.id)}}},[t._v("删除")])]}}])})],1),e("div",{staticClass:"pager",staticStyle:{"margin-top":"12px","text-align":"right"}},[e("el-pagination",{attrs:{background:"",layout:"prev, pager, next","page-size":t.pageSize,"current-page":t.page,total:t.filteredList.length},on:{"update:currentPage":function(e){t.page=e},"update:current-page":function(e){t.page=e}}})],1)],1),e("el-dialog",{attrs:{title:"编辑记录",visible:t.editDialogVisible},on:{"update:visible":function(e){t.editDialogVisible=e}}},[e("el-form",{attrs:{"label-position":"top",model:t.editForm}},[e("el-form-item",{attrs:{label:"类别"}},[e("el-select",{attrs:{placeholder:"类别"},model:{value:t.editForm.type,callback:function(e){t.$set(t.editForm,"type",e)},expression:"editForm.type"}},t._l(t.typeList,(function(t){return e("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1),e("el-form-item",{attrs:{label:"金额"}},[e("el-input",{attrs:{placeholder:"金额"},model:{value:t.editForm.amount,callback:function(e){t.$set(t.editForm,"amount",e)},expression:"editForm.amount"}})],1),e("el-form-item",{attrs:{label:"备注"}},[e("el-input",{model:{value:t.editForm.remark,callback:function(e){t.$set(t.editForm,"remark",e)},expression:"editForm.remark"}})],1),e("el-form-item",{attrs:{label:"时间"}},[e("el-date-picker",{attrs:{type:"datetime","value-format":"timestamp"},model:{value:t.editForm.time,callback:function(e){t.$set(t.editForm,"time",e)},expression:"editForm.time"}})],1)],1),e("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(e){t.editDialogVisible=!1}}},[t._v("取消")]),e("el-button",{attrs:{type:"primary"},on:{click:t.confirmEdit}},[t._v("确定")])],1)],1)],1)},i=[];r(70560),r(98858),r(61318),r(33228);const l=[{label:"衣",value:"衣"},{label:"食",value:"食"},{label:"住",value:"住"},{label:"行",value:"行"},{label:"医",value:"医"},{label:"教",value:"教"},{label:"其他",value:"其他"}],o={"衣":"#FF7043","食":"#26A69A","住":"#42A5F5","行":"#AB47BC","医":"#EC407A","教":"#5C6BC0","其他":"#90A4AE"},s="consumptionNoteData_v1";var n={name:"purchaseRecords",data(){return{typeList:l,form:{type:"食",amount:"",remark:"",time:Date.now()},list:[],filter:{type:null,range:null,keyword:""},editDialogVisible:!1,editForm:{},page:1,pageSize:10}},computed:{typeListWithColor(){return this.typeList.map((t=>({...t,color:o[t.value]||"#999"})))},typeColorMap(){const t={};return this.typeList.forEach((e=>t[e.value]=o[e.value]||"#999")),t},filteredList(){return this.list.filter((t=>{if(this.filter.type&&t.type!==this.filter.type)return!1;if(this.filter.range&&2===this.filter.range.length){const[e,r]=this.filter.range;if(t.time<e||t.time>r)return!1}if(this.filter.keyword){const e=this.filter.keyword.toLowerCase();if(!t.remark||!t.remark.toLowerCase().includes(e))return!1}return!0})).sort(((t,e)=>e.time-t.time))},pagedList(){const t=(this.page-1)*this.pageSize;return this.filteredList.slice(t,t+this.pageSize)},totalAmount(){return this.filteredList.reduce(((t,e)=>t+Number(e.amount||0)),0)}},created(){this.loadFromLocal()},methods:{formatMoney(t){const e=Number(t);return isFinite(e)?e.toFixed(2):"0.00"},formatTimestamp(t){if(!t)return"";const e=new Date(Number(t)),r=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),i=String(e.getDate()).padStart(2,"0"),l=String(e.getHours()).padStart(2,"0"),o=String(e.getMinutes()).padStart(2,"0"),s=String(e.getSeconds()).padStart(2,"0");return`${r}-${a}-${i} ${l}:${o}:${s}`},addRecord(){const t=Number(this.form.amount);if(!isFinite(t)||0===t)return void this.$message.warning("请输入有效金额");const e={id:Date.now()+Math.floor(999*Math.random()),type:this.form.type,amount:Number(t.toFixed(2)),remark:this.form.remark||"",time:this.form.time||Date.now()};this.list.unshift(e),this.$message.success("添加成功"),this.resetForm()},resetForm(){this.form.amount="",this.form.remark="",this.form.time=Date.now(),this.form.type="食"},removeRecord(t){this.list=this.list.filter((e=>e.id!==t)),this.$message.success("已删除")},editRecord(t){this.editForm=Object.assign({},t),this.editDialogVisible=!0},confirmEdit(){const t=this.list.findIndex((t=>t.id===this.editForm.id));-1!==t&&(this.$set(this.list,t,{...this.list[t],type:this.editForm.type,amount:Number(this.editForm.amount)||0,remark:this.editForm.remark,time:this.editForm.time}),this.$message.success("已保存")),this.editDialogVisible=!1},resetFilter(){this.filter.type=null,this.filter.range=null,this.filter.keyword=""},saveToLocal(){localStorage.setItem(s,JSON.stringify(this.list)),this.$message.success("已保存到本地")},loadFromLocal(){const t=localStorage.getItem(s);if(t)try{const e=JSON.parse(t);Array.isArray(e)&&(this.list=e)}catch(e){console.error(e)}},exportCsv(){if(!this.list.length)return void this.$message.warning("无数据可导出");const t=[["类别","金额","备注","时间"]];this.list.forEach((e=>{t.push([e.type,this.formatMoney(e.amount),e.remark,this.formatTimestamp(e.time)])}));const e=t.map((t=>t.map((t=>`"${String(t).replace(/"/g,'""')}"`)).join(","))).join("\n"),r=new Blob([e],{type:"text/csv;charset=utf-8;"});if(window.navigator&&window.navigator.msSaveOrOpenBlob)window.navigator.msSaveOrOpenBlob(r,"consumption.csv");else{const t=document.createElement("a");t.href=URL.createObjectURL(r),t.download="consumption.csv",t.click(),URL.revokeObjectURL(t.href)}}}},c=n,m=r(1001),u=(0,m.Z)(c,a,i,!1,null,"d8bcc5a8",null),p=u.exports}}]);
//# sourceMappingURL=472.d6acca78.js.map