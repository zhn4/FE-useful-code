"use strict";(self["webpackChunkFE_useful_code"]=self["webpackChunkFE_useful_code"]||[]).push([[466],{30466:function(t,e,a){a.r(e),a.d(e,{default:function(){return d}});var i=function(){var t=this,e=t._self._c;return e("div",{staticClass:"import-excel"},[e("div",{staticClass:"top"},[e("div",[e("el-tooltip",{staticClass:"box-item",attrs:{effect:"dark",content:t.contentByTips,placement:"top-start"}},[e("el-button",{attrs:{type:"primary"},on:{click:t.downloadTemplate}},[t._v(" 下载 Excel 模板 ")])],1)],1),e("div",[e("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.$refs.uploadRef.click()}}},[t._v(" 选择 Excel 文件 ")]),e("input",{ref:"uploadRef",staticStyle:{display:"none"},attrs:{type:"file",accept:".xlsx, .xls"},on:{change:t.handleFileUpload}})],1),t.filteredTableData.length?e("div",{staticClass:"filter"},[e("el-input",{staticStyle:{width:"150px","margin-right":"10px"},attrs:{placeholder:"输入最小余额"},model:{value:t.filter.minNum,callback:function(e){t.$set(t.filter,"minNum",t._n(e))},expression:"filter.minNum"}}),e("el-input",{staticStyle:{width:"150px","margin-right":"10px"},attrs:{placeholder:"输入最大余额"},model:{value:t.filter.maxNum,callback:function(e){t.$set(t.filter,"maxNum",t._n(e))},expression:"filter.maxNum"}}),e("el-button",{attrs:{type:"primary"},on:{click:function(e){t.filterByBalance("收入(元)")}}},[t._v("过滤收入")]),e("el-button",{attrs:{type:"primary"},on:{click:function(e){t.filterByBalance("支出(元)")}}},[t._v("过滤支出")]),e("el-button",{attrs:{type:"primary"},on:{click:function(e){t.filterByBalance("余额(元)")}}},[t._v("过滤余额")]),e("el-button",{on:{click:t.handleReset}},[t._v("重置")])],1):t._e()]),t.filteredTableData.length?e("div",{staticClass:"bottom"},[e("div",{staticClass:"b-left"},[e("el-table",{staticStyle:{width:"100%"},attrs:{data:t.filteredTableData,height:"100%",border:""}},[e("el-table-column",{attrs:{type:"index",label:"序号",width:"60"}}),t._l(t.excelData[0],(function(t,a){return e("el-table-column",{key:a,attrs:{prop:`col_${a}`,label:t}})}))],2)],1),e("div",{staticClass:"b-right"},[e("div",{staticClass:"all-statistics"},[e("div",{staticClass:"statistics"},[e("el-card",{staticClass:"box-card"},[e("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[e("div",{staticClass:"card-header"},[e("span",[t._v("收入")])]),e("el-button",{attrs:{type:"text"},on:{click:t.handleReset}},[t._v("重置")])],1),e("ul",[e("li",[t._v(" 最高："),e("span",{staticClass:"mark-num",on:{click:function(e){t.handleFilteByTypeAndNum("收入(元)",t.moneyCount.maxIncome)}}},[t._v(" "+t._s(t.moneyCount.maxIncome||"-"))]),t._v(" 元 ")]),e("li",[t._v(" 最低："),e("span",{staticClass:"mark-num",on:{click:function(e){t.handleFilteByTypeAndNum("收入(元)",t.moneyCount.minIncome)}}},[t._v(" "+t._s(t.moneyCount.minIncome||"-"))]),t._v(" 元 ")]),e("li",[t._v("中位数："+t._s(t.moneyCount.medianIncome||"-")+" 元")])])])],1),e("div",{staticClass:"statistics"},[e("el-card",{staticClass:"box-card"},[e("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[e("div",{staticClass:"card-header"},[e("span",[t._v("支出")])]),e("el-button",{attrs:{type:"text"},on:{click:t.handleReset}},[t._v("重置")])],1),e("ul",[e("li",[t._v(" 最高："),e("span",{staticClass:"mark-num",on:{click:function(e){t.handleFilteByTypeAndNum("支出(元)",t.moneyCount.maxExpense)}}},[t._v(" "+t._s(t.moneyCount.maxExpense||"-"))]),t._v(" 元 ")]),e("li",[t._v(" 最低："),e("span",{staticClass:"mark-num",on:{click:function(e){t.handleFilteByTypeAndNum("支出(元)",t.moneyCount.minExpense)}}},[t._v(" "+t._s(t.moneyCount.minExpense||"-"))]),t._v(" 元 ")]),e("li",[t._v("中位数："+t._s(t.moneyCount.medianExpense||"-")+" 元")])])])],1),e("div",{staticClass:"statistics"},[e("el-card",{staticClass:"box-card"},[e("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[e("div",{staticClass:"card-header"},[e("span",[t._v("余额")])]),e("el-button",{attrs:{type:"text"},on:{click:t.handleReset}},[t._v("重置")])],1),e("ul",[e("li",[t._v(" 最高："),e("span",{staticClass:"mark-num",on:{click:function(e){t.handleFilteByTypeAndNum("余额(元)",t.moneyCount.maxBalanceStat)}}},[t._v(" "+t._s(t.moneyCount.maxBalanceStat||"-"))]),t._v(" 元 ")]),e("li",[t._v(" 最低："),e("span",{staticClass:"mark-num",on:{click:function(e){t.handleFilteByTypeAndNum("余额(元)",t.moneyCount.minBalanceStat)}}},[t._v(" "+t._s(t.moneyCount.minBalanceStat||"-"))]),t._v(" 元 ")]),e("li",[t._v("中位数："+t._s(t.moneyCount.medianBalance||"-")+" 元")])])])],1)]),e("div",{staticClass:"other-statistics"},[e("div",{staticClass:"statistics",staticStyle:{width:"100%"}},[e("el-card",{staticClass:"box-card",staticStyle:{width:"100%"}},[e("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[e("div",{staticClass:"card-header"},[e("el-icon",{staticStyle:{"margin-right":"4px"},attrs:{size:"14"}},[e("Tickets")],1),e("span",[t._v("交易类型统计")])],1),e("el-button",{attrs:{type:"text"},on:{click:t.handleReset}},[t._v("重置")])],1),e("ul",{staticStyle:{display:"flex","flex-direction":"row"}},t._l(t.transactionStats,(function(a,i){return e("li",{key:i,staticStyle:{"margin-right":"20px"}},[t._v(" "+t._s(i)+": "),e("span",{staticClass:"mark-num",attrs:{sytle:"margin-right: 20px;"},on:{click:function(e){return t.handleFilteByType(i)}}},[t._v(t._s(a)+" 笔")])])})),0)])],1)]),e("div",{staticClass:"charts"},[e("div",{ref:"pieChart",staticClass:"chart"}),e("div",{ref:"barChart",staticClass:"chart"})])])]):e("div",{staticClass:"bottom",staticStyle:{height:"100%",display:"flex","justify-content":"center","align-items":"center"}},[e("el-empty",{staticStyle:{width:"100%",height:"100%"},attrs:{description:"请上传 Excel 文件"}})],1)])},s=[],n=(a(24224),a(61121),a(37133),a(98858),a(61318),a(33228),a(70560),a(87092)),l=a(30750),c=a(8499),o={name:"ImportExcel",data(){return{excelData:[],tableData:[],filteredTableData:[],transactionStats:{},filter:{minNum:null,maxNum:null},charts:[],moneyCount:{maxIncome:0,minIncome:0,maxExpense:0,minExpense:0,maxBalanceStat:0,minBalanceStat:0},contentByTips:"请按照模版内容填写数据"}},mounted(){},methods:{handleFileUpload(t){c.Loading.service({lock:!0,text:"正在解析 Excel 文件...",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"});const e=t.target.files[0];if(!e)return;const a=new FileReader;a.onload=t=>{const e=new Uint8Array(t.target.result),a=n.ij(e,{type:"array"}),i=a.SheetNames[0],s=a.Sheets[i],l=n.P6.sheet_to_json(s,{header:1});this.excelData=l,this.tableData=this.excelData.slice(1).map((t=>{const e={};return t.forEach(((t,a)=>{e[`col_${a}`]=t})),e})),this.filteredTableData=[...this.tableData],this.calculateTransactionStats(),this.$nextTick((()=>{this.initPieChart(),this.initBarChart(),setTimeout((()=>{c.Loading.service().close()}),800)})),this.calculateFinancialStats()},a.readAsArrayBuffer(e)},calculateTransactionStats(){const t=this.excelData[0].indexOf("交易类型");if(-1===t)return void(this.transactionStats={});const e={};this.excelData.slice(1).forEach((a=>{const i=a[t];i&&(e[i]=(e[i]||0)+1)})),this.transactionStats=e},calculateFinancialStats(){const t=this.excelData[0].indexOf("收入(元)"),e=this.excelData[0].indexOf("支出(元)"),a=this.excelData[0].indexOf("余额(元)");if(-1===t||-1===e||-1===a)return this.moneyCount.maxIncome=this.moneyCount.minIncome=this.moneyCount.maxExpense=this.moneyCount.minExpense=this.moneyCount.maxBalanceStat=this.moneyCount.minBalanceStat=0,void(this.moneyCount.medianIncome=this.moneyCount.medianExpense=this.moneyCount.medianBalance=0);const i=this.excelData.slice(1).map((e=>parseFloat(e[t])||0)),s=this.excelData.slice(1).map((t=>parseFloat(t[e])||0)),n=this.excelData.slice(1).map((t=>parseFloat(t[a])||0));this.moneyCount.maxIncome=Math.max(...i),this.moneyCount.minIncome=Math.min(...i),this.moneyCount.maxExpense=Math.max(...s),this.moneyCount.minExpense=Math.min(...s),this.moneyCount.maxBalanceStat=Math.max(...n),this.moneyCount.minBalanceStat=Math.min(...n),this.moneyCount.medianIncome=this.calculateMedian(i),this.moneyCount.medianExpense=this.calculateMedian(s),this.moneyCount.medianBalance=this.calculateMedian(n)},calculateMedian(t){const e=t.filter((t=>!isNaN(t))).sort(((t,e)=>t-e)),a=e.length;if(0===a)return 0;const i=Math.floor(a/2);return a%2===0?(e[i-1]+e[i])/2:e[i]},filterByBalance(t){const e=this.excelData[0].indexOf(t);if(-1===e)return void(this.filteredTableData=[...this.tableData]);const a=this.tableData.filter(((t,a)=>{const i=parseFloat(this.excelData[a+1][e])||0;return(null===this.filter.minNum||i>=this.filter.minNum)&&(null===this.filter.maxNum||i<=this.filter.maxNum)}));0!==a.length?this.filteredTableData=a:this.$message({message:"没有符合条件的数据",type:"warning"})},handleReset(){this.filter.minNum=null,this.filter.maxNum=null,this.filteredTableData=[...this.tableData]},handleFilteByType(t){const e=this.excelData[0].indexOf("交易类型");this.filteredTableData=-1!==e?this.tableData.filter(((a,i)=>{const s=this.excelData[i+1][e];return s===t})):[...this.tableData]},handleFilteByTypeAndNum(t,e){const a=this.excelData[0].indexOf(t);this.filteredTableData=-1!==a?this.tableData.filter(((t,i)=>{const s=this.excelData[i+1][a];return s===e})):[...this.tableData]},downloadTemplate(){const t=["交易日期","交易类型","摘要说明","收入(元)","支出(元)","余额(元)","对方账户","备注"],e=[t],a=n.P6.aoa_to_sheet(e),i=n.P6.book_new();n.P6.book_append_sheet(i,a,"模板");const s=n.cW(i,{bookType:"xlsx",type:"array"}),l=new Blob([s],{type:"application/octet-stream"}),c=document.createElement("a");c.href=URL.createObjectURL(l),c.download="模板.xlsx",c.click(),URL.revokeObjectURL(c.href)},initPieChart(){const t=l.init(this.$refs.pieChart),e={title:{text:"交易类型占比",left:"center"},series:[{type:"pie",radius:"50%",data:Object.keys(this.transactionStats).map((t=>({value:this.transactionStats[t],name:t}))),emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}},label:{formatter:"{b}: {c}笔 ({d}%)"}}]};t.setOption(e),this.charts.push(t)},initBarChart(){const t=l.init(this.$refs.barChart),e={title:{text:"交易类型分布",left:"center"},xAxis:{type:"category",data:Object.keys(this.transactionStats)},yAxis:{type:"value"},series:[{data:Object.values(this.transactionStats),type:"bar"}]};t.setOption(e),this.charts.push(t)}}},r=o,m=a(1001),h=(0,m.Z)(r,i,s,!1,null,"7915b51f",null),d=h.exports}}]);
//# sourceMappingURL=466.201d99a1.js.map