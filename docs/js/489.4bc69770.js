"use strict";(self["webpackChunkfe_useful_code"]=self["webpackChunkfe_useful_code"]||[]).push([[489],{22489:function(t,e,a){a.r(e),a.d(e,{default:function(){return x}});var o=function(){var t=this,e=t._self._c;return e("div",{staticClass:"page"},[e("div",{staticClass:"left-part"},[e("editorByFlow",{attrs:{nodeData:t.allNodes},on:{renderAgain:t.renderAgain,generateLinks:t.generateLinks,moveTop:t.moveTop,moveBottom:t.moveBottom}})],1),e("div",{ref:"parentContainerRef",staticClass:"right-part",staticStyle:{width:"100%",height:"100%"}},[e("div",{ref:"lineChart",staticClass:"chart"}),e("el-dialog",{attrs:{title:t.currentName,visible:t.dialogVisible,width:"600px"},on:{"update:visible":function(e){t.dialogVisible=e}}},[e("el-form",{ref:"form",attrs:{model:t.currentNode,"label-width":"120px"}},[e("el-form-item",{attrs:{label:"业务流程说明："}},[e("span",[t._v(t._s(t.currentNode?.desc||null))])]),e("el-form-item",{attrs:{label:"工作时效："}},[e("span",[t._v(t._s(t.currentNode?.workTime||null))])]),e("el-form-item",{attrs:{label:"所需上传附件："}},[e("span",[t._v(t._s(t.currentNode?.file||null))])]),e("el-form-item",{attrs:{label:"跳转链接："}},[t.currentNode?.routePath?e("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.goToPage(t.currentNode)}}},[t._v(" 跳转该页面 ")]):t._e()],1)],1),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{attrs:{type:"primary"},on:{click:function(e){t.dialogVisible=!1}}},[t._v("关闭")])],1)],1)],1)])},l=[],r=a(7323),i=function(){var t=this,e=t._self._c;return e("div",{staticClass:"form-part"},[e("div",{staticClass:"editor-part"},[e("div",{staticStyle:{"text-align":"right","margin-bottom":"10px"}},[e("el-row",{attrs:{gutter:20}},[e("el-col",{attrs:{span:2}},[e("el-statistic",{attrs:{value:t.countByMainNode,title:"主节点"}})],1),e("el-col",{attrs:{span:2}},[e("el-statistic",{attrs:{value:t.countByChildNode,title:"子节点"}})],1),e("el-col",{attrs:{span:2}},[e("el-statistic",{attrs:{value:this.form.listData.length||0,title:"合计"}})],1),e("el-col",{attrs:{span:18}},[e("el-button",{attrs:{type:"primary"},on:{click:t.handleRender}},[t._v("渲染")]),e("el-button",{attrs:{type:"success"},on:{click:t.handleGenerateLinksByAll}},[t._v("生成连接线(debug)")]),e("el-button",{on:{click:t.onAddNode}},[t._v("新增节点")]),e("el-button",{attrs:{type:"primary"},on:{click:t.onCheckJson}},[t._v("查看JSON")])],1)],1),e("span")],1),e("div",{staticClass:"table-part"},[e("el-form",{ref:"form",staticStyle:{height:"100%"},attrs:{model:t.form,size:"mini","label-width":"60px"}},[e("el-table",{staticStyle:{width:"100%"},attrs:{data:t.form.listData,border:"",height:"100%",size:"mini"}},[e("el-table-column",{attrs:{type:"index",label:"序号",align:"center",width:"50"}}),e("el-table-column",{attrs:{prop:"name",label:"基础信息",align:"center"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("el-form-item",{attrs:{prop:`listData.${a.$index}.name`,label:"名字"}},[e("el-input",{attrs:{placeholder:"请输入"},model:{value:a.row.name,callback:function(e){t.$set(a.row,"name","string"===typeof e?e.trim():e)},expression:"scope.row.name"}})],1),e("el-form-item",{attrs:{prop:`listData.${a.$index}.id`,label:"id"}},[e("el-input",{attrs:{placeholder:"请输入"},model:{value:a.row.id,callback:function(e){t.$set(a.row,"id","string"===typeof e?e.trim():e)},expression:"scope.row.id"}})],1),e("el-form-item",{attrs:{prop:`listData.${a.$index}.x`,label:"x"}},[e("el-input",{attrs:{type:"number",placeholder:"请输入"},model:{value:a.row.x,callback:function(e){t.$set(a.row,"x","string"===typeof e?e.trim():e)},expression:"scope.row.x"}})],1),e("el-form-item",{attrs:{prop:`listData.${a.$index}.y`,label:"y"}},[e("el-input",{attrs:{type:"number",placeholder:"请输入"},model:{value:a.row.y,callback:function(e){t.$set(a.row,"y","string"===typeof e?e.trim():e)},expression:"scope.row.y"}})],1)]}}])}),e("el-table-column",{attrs:{prop:"name",label:"扩展信息",align:"center"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("el-form-item",{attrs:{prop:`listData.${a.$index}.extraData.main`,label:"主节点",align:"left"}},[e("el-switch",{attrs:{"active-color":"#13ce66","inactive-color":"#ff4949"},model:{value:a.row.extraData.main,callback:function(e){t.$set(a.row.extraData,"main",e)},expression:"scope.row.extraData.main"}})],1),e("el-form-item",{attrs:{prop:`listData.${a.$index}.extraData.desc`,label:"描述"}},[e("el-input",{attrs:{type:"textarea",placeholder:"请输入",rows:"4",resize:"none"},model:{value:a.row.extraData.desc,callback:function(e){t.$set(a.row.extraData,"desc","string"===typeof e?e.trim():e)},expression:"scope.row.extraData.desc"}})],1),e("el-form-item",{attrs:{prop:`listData.${a.$index}.extraData.workTime`,label:"时间"}},[e("el-input",{attrs:{placeholder:"请输入"},model:{value:a.row.extraData.workTime,callback:function(e){t.$set(a.row.extraData,"workTime","string"===typeof e?e.trim():e)},expression:"scope.row.extraData.workTime"}})],1),e("el-form-item",{attrs:{prop:`listData.${a.$index}.extraData.file`,label:"文件"}},[e("el-input",{attrs:{type:"textarea",placeholder:"请输入",rows:"2",resize:"none"},model:{value:a.row.extraData.file,callback:function(e){t.$set(a.row.extraData,"file","string"===typeof e?e.trim():e)},expression:"scope.row.extraData.file"}})],1),e("el-form-item",{attrs:{prop:`listData.${a.$index}.extraData.routePath`,label:"路由"}},[e("el-input",{attrs:{placeholder:"请输入"},model:{value:a.row.extraData.routePath,callback:function(e){t.$set(a.row.extraData,"routePath","string"===typeof e?e.trim():e)},expression:"scope.row.extraData.routePath"}})],1)]}}])}),e("el-table-column",{attrs:{label:"操作",align:"center",width:"80"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("el-button",{staticStyle:{color:"red"},attrs:{type:"text"}},[t._v("删除")]),e("el-button",{attrs:{type:"text"},on:{click:function(e){return t.onMoveTop(a.row.$index)}}},[t._v("上移")]),e("el-button",{attrs:{type:"text"},on:{click:function(e){return t.onMoveBottom(a.row.$index)}}},[t._v("下移")])]}}])})],1)],1)],1)]),e("el-drawer",{attrs:{title:"提示",visible:t.visibleDialog,size:"800px"},on:{"update:visible":function(e){t.visibleDialog=e}}},[e("json-viewer",{attrs:{value:t.form.listData,"expand-depth":1,copyable:"",boxed:"",sort:""}}),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{attrs:{type:"primary"},on:{click:function(e){t.visibleDialog=!1}}},[t._v("关闭")])],1)],1)],1)},n=[],s=(a(70560),{name:"editorByFlow",data(){return{form:{listData:[{name:"第一个",id:"one",x:500,y:0,extraData:{main:!0,desc:"",workTime:"",file:"",routePath:"",hidden:!1}},{name:"第二个",id:"two",x:500,y:500,extraData:{main:!0,desc:"",workTime:"",file:"",routePath:"",hidden:!1}},{name:"第二个-1",id:"two-1",x:100,y:500,extraData:{main:!1,desc:"",workTime:"",file:"",routePath:"",hidden:!1}},{name:"第二个-2",id:"two-2",x:900,y:500,extraData:{main:!1,desc:"",workTime:"",file:"",routePath:"",hidden:!1}},{name:"第二个-3",id:"two-3",x:100,y:600,extraData:{main:!1,desc:"",workTime:"",file:"",routePath:"",hidden:!1}}]},allLinks:[],visibleDialog:!1}},computed:{countByMainNode(){return this.form.listData.filter((t=>t.extraData.main)).length},countByChildNode(){return this.form.listData.filter((t=>!t.extraData.main)).length}},methods:{handleRender(){this.handleGenerateLinksByAll(),this.$emit("renderAgain",{allNodes:this.form.listData,allLinks:this.allLinks})},handleGenerateLinksByAll(){const t=this.handleLineByMain(this.form.listData),e=this.handleLineByChildren(this.form.listData);console.log("展示所有连线"),t.forEach((t=>{console.log(`%c ${t.source} %c -> %c ${t.target}`,"color: red;","color: #333;","color: red;")})),e.forEach((t=>{console.log(`%c ${t.source} %c-> %c ${t.target}`,"color: green;","color: #333;","color: red;")})),this.allLinks=[...t,...e],this.$emit("generateLinks",this.allLinks)},handleLineByMain(t){console.log("%c 主连接线","font-size: 20px; color: red;");const e=t.filter((t=>t.extraData&&t.extraData.main)).sort(((t,e)=>{const a=(t.y||0)-(e.y||0);return 0!==a?a:(t.x||0)-(e.x||0)})),a=[];for(let o=1;o<e.length;o++)a.push({source:e[o-1].id,target:e[o].id});return console.log(a),a},handleLineByChildren(t){console.log("%c 子连接线","font-size: 20px; color: orange;"),console.log("%c 主节点包括","color: blue;");const e=t.filter((t=>!0===t.extraData.main));console.log(e),console.log("%c --- 根据主节点过滤的数据 start ---","color: blue;");let a=[];return e.forEach((e=>{console.log(`%c 主节点 ${e.name} ${e.id}`,"color: green;"),t.filter((t=>{t.id.match(`${e.id}-`)&&(console.log(`%c ${t.name} ${t.id}`,"color: red;"),a.push({source:e.id,target:t.id}))}))})),console.log("%c --- 根据主节点过滤的数据 end ---","color: blue;"),console.log(a),a},onAddNode(){const t=this.form.listData.filter((t=>t.extraData.main)).length;this.form.listData.push({name:`新的节点${t}`,id:`newMainNode${t}`,x:500,y:500*t,extraData:{main:!0,desc:"",workTime:"",file:"",routePath:"",hidden:!1}})},onMoveTop(){this.$emit("moveTop",!0)},onMoveBottom(){this.$emit("moveBottom",!0)},exportToJson(){const t=JSON.stringify(this.form.listData,null,2),e="data:application/json;charset=utf-8,"+encodeURIComponent(t),a="nodeData.json",o=document.createElement("a");o.setAttribute("href",e),o.setAttribute("download",a),o.click()},onCheckJson(){this.visibleDialog=!0}}}),c=s,d=a(1001),f=(0,d.Z)(c,i,n,!1,null,"245180ea",null),m=f.exports,h={name:"flowByGraph",components:{editorByFlow:m},data(){return{charts:{},dialogVisible:!1,currentNode:{main:!1,desc:"",workTime:"",file:"",routePath:""},currentName:"",allNodes:[],allLinks:[]}},mounted(){},methods:{initLineChart(){const t=r.init(this.$refs.lineChart),e=this.allNodes.filter((t=>!t.hidden)),a=80,o=e.map((t=>t.x||0)),l=e.map((t=>t.y||0)),i=Math.min(...o),n=Math.max(...o),s=Math.min(...l),c=Math.max(...l),d=(Math.max(800,Math.ceil(n-i+2*a)),Math.max(600,Math.ceil(c-s+2*a))),f=this.$refs.lineChart,m=this.$refs.parentContainerRef;f.style.width=m.getBoundingClientRect().width-20+"px",f.style.height=d+"px",f.parentElement&&(f.parentElement.style.overflow="auto"),t.resize();const h=a-i,u=a-s,p=e.map((t=>({...t,x:(t.x||0)+h,y:(t.y||0)+u}))),x=this.allLinks.map((t=>{const e=this.allNodes.find((e=>e.id===t.source)),a=this.allNodes.find((e=>e.id===t.target));if(!e||!a)return null;const o=[(e.x||0)+h,(e.y||0)+u],l=[(a.x||0)+h,(a.y||0)+u];return{...t,coords:[o,l]}})).filter(Boolean),g={graphic:this.renderGridGraphic?this.renderGridGraphic():void 0,series:[{type:"graph",layout:"none",roam:!0,scaleLimit:{min:1,max:1.8},label:{show:!0,fontSize:14,color:"#FFF",formatter:"{b}"},symbol:"rect",edgeSymbol:["none","none"],edgeLabel:{fontSize:12},data:p,links:x}]};t.setOption(g),this.charts=t;const b=this;t.on("click",(function(t){"node"===t.dataType&&b.handleNodeClick(t)}))},handleNodeClick(t){if(this.currentName=t.name||"流程说明",t.data&&t.data.extraData&&!1===t.data.extraData.main?(this.currentNode=t.data.extraData,this.dialogVisible=!0):this.currentNode=null,t.data&&t.data.extraData&&!0===t.data.extraData.main){this.allNodes.forEach((e=>{e.id.match(`${t.data.id}-`)&&(e.hidden=!e.hidden)}));const e=this.allNodes.filter((e=>e.id.match(`${t.data.id}-`))).length,a=this.allNodes.findIndex((e=>e.id===t.data.id));this.allNodes[a].name.includes("(")?this.allNodes[a].name=this.allNodes[a].name.split("(")[0]:this.allNodes[a].name=`${this.allNodes[a].name}(${e})`,this.charts.setOption({series:[{data:this.allNodes.filter((t=>!t.hidden))}]})}},goToPage(t){if(t&&t.routePath){const e=this.$router.resolve({path:t.routePath}).href;window.open(e,"_blank")}},renderAgain(t){console.log(t),console.log(this.charts),this.charts.dispose&&(console.log("销毁图表实例"),this.charts.dispose()),this.allNodes=this.rebuildAllNodesData(t.allNodes),this.allLinks=t.allLinks,console.log("接收到的数据"),console.log(t),setTimeout((()=>{this.initLineChart()}),800)},rebuildAllNodesData(t){return t.map((t=>{const e=new r.graphic.LinearGradient(0,0,1,0,[{offset:0,color:"#ffffff"},{offset:.25,color:"#409EFF"},{offset:.5,color:"#409EFF"},{offset:.75,color:"#409EFF"},{offset:1,color:"#ffffff"}]),a=new r.graphic.LinearGradient(0,0,1,0,[{offset:0,color:"#ffffff"},{offset:.5,color:"#79BBFF"},{offset:1,color:"#ffffff"}]),o=t.extraData&&t.extraData.main?e:a;function l(t,e=14,a=20){return t.length*e+a}const i=l(t.name||""),n=(t.id||"").toString(),s=n.match(/(\d+)$/);let c=0;if(s){const t=parseInt(s[1],10),e=t%2===1;c=e?-Math.floor(i/2):Math.floor(i/2)}else c=0;return{...t,symbolSize:[i,30],symbolOffset:[c,0],itemStyle:{color:o,borderColor:"#b3d8ff",borderWidth:1,shadowColor:"rgba(0,0,0,0.15)",shadowBlur:6},label:{show:!0,color:"#000",fontSize:14,formatter:"{b}",fontWeight:"bolder"}}}))},generateLinks(t){this.allLinks=t.map((t=>({...t,lineStyle:{width:1,color:"#2590ff"}})))},moveTop(){this.moveNode(this.selectedNode,-1)},moveBottom(){this.moveNode(this.selectedNode,1)},moveNode(t,e){}}},u=h,p=(0,d.Z)(u,o,l,!1,null,"f084e3e2",null),x=p.exports}}]);
//# sourceMappingURL=489.4bc69770.js.map