"use strict";(self["webpackChunkFE_useful_code"]=self["webpackChunkFE_useful_code"]||[]).push([[137],{6137:function(t,e,s){s.r(e),s.d(e,{default:function(){return y}});var l=function(){var t=this,e=t._self._c;return e("div",{staticClass:"tv-stream-page"},[e("div",{staticClass:"btns"},[e("el-button",{attrs:{type:"primary",size:"mini",loading:t.loading,disabled:t.loading},on:{click:t.fetchM3uList}},[t._v("手动刷新直播源")]),e("el-select",{staticStyle:{width:"180px"},attrs:{placeholder:`选择源(${t.streamList.length})`,filterable:""},model:{value:t.selectedUrl,callback:function(e){t.selectedUrl=e},expression:"selectedUrl"}},t._l(t.streamList,(function(t,s){return e("el-option",{key:s,attrs:{label:`${s+1} - ${t.name}`,value:t.url}})})),1),e("el-select",{staticStyle:{width:"180px"},attrs:{placeholder:`FLV源(${t.streamListByFLV.length})`,filterable:""},model:{value:t.selectedUrl,callback:function(e){t.selectedUrl=e},expression:"selectedUrl"}},t._l(t.streamListByFLV,(function(t,s){return e("el-option",{key:s,attrs:{label:`${s+1} - ${t.name}`,value:t.url}})})),1),e("el-select",{staticStyle:{width:"180px"},attrs:{placeholder:`HLV源(${t.streamListByHLV.length})`,filterable:""},model:{value:t.selectedUrl,callback:function(e){t.selectedUrl=e},expression:"selectedUrl"}},t._l(t.streamListByHLV,(function(t,s){return e("el-option",{key:s,attrs:{label:`${s+1} - ${t.name}`,value:t.url}})})),1)],1),t.selectedUrl?e("div",{staticClass:"player-area"},[e("div",{staticStyle:{width:"800px",height:"450px",background:"#000"},attrs:{id:"dplayer"}})]):t._e()])},a=[],r=(s(560),s(3831)),i=s.n(r),n=s(6301),c=s(2747),u=s.n(c);const o="tv_stream_list_cache";var d={name:"TvStream",data(){return{streamList:[],selectedUrl:"",dp:null,loading:!1}},computed:{streamListByFLV(){return this.streamList.filter((t=>t.url.endsWith(".flv")||t.url.endsWith(".hlv")))},streamListByHLV(){return this.streamList.filter((t=>t.url.endsWith(".m3u8")||t.url.endsWith(".hlv")))}},watch:{selectedUrl(t){t&&this.initPlayer(t)}},mounted(){const t=localStorage.getItem(o);if(t)try{this.streamList=JSON.parse(t)}catch(e){}this.fetchM3uList()},methods:{async fetchM3uList(){this.loading=!0;try{const t=await fetch("https://gh.tryxd.cn/raw.githubusercontent.com/suxuang/myIPTV/main/ipv4.m3u"),e=await t.text();this.streamList=this.parseM3u(e),localStorage.setItem(o,JSON.stringify(this.streamList))}catch(t){this.$message.error("直播源列表获取失败")}finally{this.loading=!1}},parseM3u(t){const e=t.split("\n"),s=[];let l="";return e.forEach((t=>{if(t=t.trim(),t.startsWith("#EXTINF")){const e=t.match(/,(.*)$/);l=e?e[1].trim():"未知频道"}else t&&!t.startsWith("#")&&s.push({name:l,url:t})})),s},getPlayerTypeAndCustomType(t){return t.endsWith(".m3u8")?{type:"customHls",customType:this.createHlsCustomType(t)}:t.endsWith(".flv")||t.endsWith(".hlv")?{type:"customFlv",customType:this.createFlvCustomType(t)}:{type:"auto",customType:{}}},createHlsCustomType(t){return{customHls:function(e){if(n.ZP.isSupported()){const s=new n.ZP;s.loadSource(t),s.attachMedia(e)}}}},createFlvCustomType(t){return{customFlv:function(e){if(u().isSupported()){const s=u().createPlayer({type:"flv",url:t});s.attachMediaElement(e),s.load(),s.play()}}}},initPlayer(t){this.dp&&(this.dp.destroy(),this.dp=null);const{type:e,customType:s}=this.getPlayerTypeAndCustomType(t);this.$nextTick((()=>{this.dp=new(i())({container:document.getElementById("dplayer"),autoplay:!0,video:{url:t,type:e,customType:s}})}))}}},h=d,p=s(1001),m=(0,p.Z)(h,l,a,!1,null,"26358ceb",null),y=m.exports}}]);
//# sourceMappingURL=137.16d8a13b.js.map